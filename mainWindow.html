<!DOCTYPE html>
<html lang="en">
<head>
    <title>Kubeboard</title>
    <link rel="stylesheet" href="./app/css/style.css" />
</head>
<body>
    <h1>Kubeboard</h1>
    <select  id="namespaces" onchange="getPods()"></select>
    <table id="podtable" aria-label="PodList"> 
        <tr>
            <th scope="col">Name</th> 
            <th scope="col">Node</th> 
            <th scope="col">Status</th> 
            <th scope="col">Restart</th>
            <th scope="col">Age</th>
            <th scope="col">Actions</th>
        </tr>
    </table>
    <script>
     //   console.log("asdfadfasd")
        const k8s = require('@kubernetes/client-node');

        const kc = new k8s.KubeConfig();
        kc.loadFromDefault();
        console.log("dfsdfdaafasdfasdfasdf")
        const k8sApi = kc.makeApiClient(k8s.CoreV1Api);
       
        getNamespaces()
        function getNamespaces(){
            k8sApi.listNamespace().then((res) => {
            let nsSelect = document.getElementById("namespaces")
            res.body.items.forEach((value)=>{
                var option = document.createElement("option");
                option.text = value.metadata.name;
                option.value = value.metadata.name;
                nsSelect.add(option);
            });
            getPods()
        });
        }

        function getPods(){
            var nsName = document.getElementById("namespaces").value;
            k8sApi.listNamespacedPod(nsName).then((res) => {
            // console.log("pods", res.body);
            res.body.items.forEach((value)=>{
                
                console.log("value===", value)
                let restartCount = 0
                value.status.containerStatuses.forEach((containerStatus)=>{
                    restartCount += containerStatus.restartCount
                });
                
                console.log("Name=", value.metadata.name)
                console.log("Node=", value.spec.nodeName)
                console.log("restartCount=", restartCount)
            });
        });
        }
    </script>
</body>
</html>